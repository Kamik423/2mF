PARAMETER landingpad.
DECLARE PARAMETER margin IS 0.
WAIT UNTIL SHIP:ALTITUDE - landingpad:TERRAINHEIGHT - margin < 0.5 * ( SHIP:VERTICALSPEED ^ 2 / (SHIP:MAXTHRUST / SHIP:MASS - 9.81)). 
IF NOT BRAKES { TOGGLE BRAKES.}
LOCK vTarget_horizontal TO landingpad:ALTITUDEPOSITION(SHIP:ALTITUDE):MAG / 8.
LOCK steeringVector TO landingpad:ALTITUDEPOSITION(SHIP:ALTITUDE):NORMALIZED * vTarget_horizontal * (1.75 - THROTTLE) - VECTOREXCLUDE(SHIP:UP:FOREVECTOR, SHIP:VELOCITY:SURFACE)*1.2.
LOCK THROTTLE TO 1.
LOCK STEERING TO LOOKDIRUP( steeringVector + SHIP:UP:FOREVECTOR:NORMALIZED * 55, HEADING(90,0):FOREVECTOR).
WAIT UNTIL SHIP:VERTICALSPEED > -50.
LOCK THROTTLE TO - SHIP:VERTICALSPEED / ( (SHIP:ALTITUDE - landingpad:TERRAINHEIGHT)/1.5 - 3 ).
WAIT UNTIL ALT:RADAR < 50.
IF NOT GEAR { TOGGLE GEAR.}
WAIT UNTIL SHIP:VERTICALSPEED > -0.1.
TOGGLE BRAKES.

